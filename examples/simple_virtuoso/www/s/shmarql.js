'use strict';import{AssertionError,AttributeError,BaseException,DeprecationWarning,Exception,IndexError,IterableError,KeyError,NotImplementedError,RuntimeWarning,StopIteration,UserWarning,ValueError,Warning,__JsIterator__,__PyIterator__,__Terminal__,__add__,__and__,__call__,__class__,__envir__,__eq__,__floordiv__,__ge__,__get__,__getcm__,__getitem__,__getslice__,__getsm__,__gt__,__i__,__iadd__,__iand__,__idiv__,__ijsmod__,__ilshift__,__imatmul__,__imod__,__imul__,__in__,__init__,__ior__,__ipow__,
__irshift__,__isub__,__ixor__,__jsUsePyNext__,__jsmod__,__k__,__kwargtrans__,__le__,__lshift__,__lt__,__matmul__,__mergefields__,__mergekwargtrans__,__mod__,__mul__,__ne__,__neg__,__nest__,__or__,__pow__,__pragma__,__pyUseJsNext__,__rshift__,__setitem__,__setproperty__,__setslice__,__sort__,__specialattrib__,__sub__,__super__,__t__,__terminal__,__truediv__,__withblock__,__xor__,abs,all,any,assert,bool,bytearray,bytes,callable,chr,copy,deepcopy,delattr,dict,dir,divmod,enumerate,filter,float,getattr,
hasattr,input,int,isinstance,issubclass,len,list,map,max,min,object,ord,pow,print,property,py_TypeError,py_iter,py_metatype,py_next,py_reversed,py_typeof,range,repr,round,set,setattr,sorted,str,sum,tuple,zip}from"./org.transcrypt.__runtime__.js";import{A,Address,Area,Article,Aside,Audio,B,Blockquote,Body,Br,Button,Canvas,Caption,Cite,Code,Col,Datalist,Dd,Div,Dl,Dt,Em,Embed,Fieldset,Figcaption,Figure,Footer,Form,H1,H2,H3,H4,H5,H6,Head,Header,Hr,Html,HtmlElement,I,Img,Input,KWElement,Label,Legend,Li,
Link,Main,Map,Meta,Meter,Nav,Noscript,Object,Ol,Optgroup,Option,Output,P,Param,Pre,Progress,S,Samp,Script,Section,Select,Small,Source,Span,Strong,Style,Sub,Sup,Table,Tbody,Td,Textarea,Tfoot,Th,Thead,Title,Tr,Track,U,Ul,Video,convertAttrKeys,indented,renderCss,renderInlineStyle}from"./htmltree.js";var __name__="__main__";export var PREFIX=dict({"rdf":"http://www.w3.org/1999/02/22-rdf-syntax-ns#","rdfs":"http://www.w3.org/2000/01/rdf-schema#","owl":"http://www.w3.org/2002/07/owl#","schema":"http://schema.org/",
"wd":"http://www.wikidata.org/entity/","wds":"http://www.wikidata.org/entity/statement/","wikibase":"http://wikiba.se/ontology#","wdt":"http://www.wikidata.org/prop/direct/","skos":"http://www.w3.org/2004/02/skos/core#","dct":"http://purl.org/dc/terms/","dbr":"http://dbpedia.org/resource/","dc":"http://purl.org/dc/elements/1.1/","foaf":"http://xmlns.com/foaf/0.1/","arco":"https://w3id.org/arco/"});export var shmarql_element=document.getElementById("shmarql");export var sparql=async function(endpoint,
q){var res=await fetch(endpoint+"?query="+encodeURIComponent(q)+"&format=application%2Fsparql-results%2Bjson",{"method":"GET","mode":"cors","headers":{"Accept":"application/sparql-results+json"}});if(res.status!=200){var txt=await res.text();return{"error":txt}}return await res.json()};export var puri=function(u){for(var [prefix,replacement]of PREFIX.py_items())if(u.startswith(replacement))return u.py_replace(replacement,prefix+":");return u};export var PFX=function(u){for(var [prefix,replacement]of PREFIX.py_items())if(u.startswith(prefix+
":"))return u.py_replace(prefix+":",replacement)};export var find_attr_parents=function(element,attr){var val=element.getAttribute(attr);if(val&&len(val)>0)return val;var parent=element.parentElement;if(parent)return find_attr_parents(parent,attr)};export var vals_for_prefix=function(results,p){var buf=[];for(var item of results){if(!__in__("p",item))continue;if(!__in__("o",item))continue;for(var [k,v]of dict(item).py_items())if(item["p"]["type"]=="uri"&&item["p"]["value"]==p)buf.append(item["o"])}return buf};
export var batch_prefixes=function(results){var buf=dict({});for(var item of results){if(!__in__("p",item))continue;if(!__in__("o",item))continue;buf.py_setdefault(item["p"]["value"],[]).append(item["o"])}return buf};export var val=function(data,elem,field,dest_type,show_field){if(typeof dest_type=="undefined"||dest_type!=null&&dest_type.hasOwnProperty("__kwargtrans__"))var dest_type=null;if(typeof show_field=="undefined"||show_field!=null&&show_field.hasOwnProperty("__kwargtrans__"))var show_field=
false;if(!__in__(field,data))return false;var dest_type=dest_type||P;for(var d of data[field]){var value=d["value"];if(d["type"]=="uri")elem.C.append(P(puri(value),__kwargtrans__({wanted:"_",uri:value,style:dict({"margin":"0","cursor":"pointer"})})));else{elem.C.append(P(value,__kwargtrans__({style:dict({"margin":"0","cursor":"pointer"})})));if(show_field)elem.C.append(P(field,__kwargtrans__({style:dict({"margin":"0 0 1ch 0","padding-left":"4ch","font-size":"75%","color":"#ddd"})})))}}return true};
export var therest=function(data,elem,exclude_fields){var t=Table(__kwargtrans__({_class:"table table-striped"}));var tbody=Tbody();t.C.append(tbody);var exclude_fields=function(){var __accu0__=[];for(var field of exclude_fields)__accu0__.append(PFX(field));return __accu0__}();for(var [fieldname,rows]of data.py_items()){if(__in__(fieldname,exclude_fields))continue;var t_row=Tr();tbody.C.append(t_row);var t_row_d=Td();t_row.C.append(Td(puri(fieldname)));t_row.C.append(t_row_d);val(data,t_row_d,fieldname)}elem.C.append(t)};
export var show_single=function(results){var subject_data=batch_prefixes(results);var content=Div();val(subject_data,content,PFX("schema:name"),H1,true);val(subject_data,content,PFX("schema:description"),H3,true);val(subject_data,content,PFX("skos:label"),H1,true);var has_title=val(subject_data,content,PFX("dc:title"),H1,true);if(!has_title)var has_label=val(subject_data,content,PFX("rdfs:label"),H2,true);val(subject_data,content,PFX("rdfs:subClassOf"),true);var has_description=val(subject_data,content,
PFX("dc:description"),true);if(!has_description)val(subject_data,content,PFX("rdfs:comment"),true);if(__in__(PFX("foaf:depiction"),subject_data))for(var depiction of subject_data[PFX("foaf:depiction")])content.C.append(Img(__kwargtrans__({src:depiction["value"],style:dict({"width":"20vw"})})));therest(subject_data,content,["schema:name","schema:description","skos:label","dc:title","dc:description","rdfs:label","rdfs:subClassOf","rdfs:comment","foaf:depiction"]);shmarql_element.innerHTML=content.render()};
export var show_list=function(results){var thead_tr=Tr();for(var headvar of results["head"]["vars"])thead_tr.C.append(Td(headvar));var tbody=Tbody();for(var row of results["results"]["bindings"]){var arow=Tr();for(var [k,v]of dict(row).py_items())if(v["type"]=="uri"){var vv=Span(puri(v["value"]),__kwargtrans__({wanted:"S",uri:"<"+v["value"]+">",style:dict({"cursor":"pointer"})}));arow.C.append(Td(vv))}else arow.C.append(Td(v["value"]));tbody.C.append(arow)}var t=Table(Thead(thead_tr),tbody,__kwargtrans__({_class:"table table-striped"}));
shmarql_element.innerHTML=t.render()};export var navigate=async function(s,p,o){var new_url="?";if(s!="?s")new_url+="s="+encodeURIComponent(s.strip());if(p!="?p")new_url+="&p="+encodeURIComponent(p.strip());if(o!="?o")new_url+="&o="+encodeURIComponent(o.strip());history.pushState(dict({}),"",new_url);var q="SELECT * WHERE { ";q+=s+" ";q+=p+" ";q+=o+" ";q+=" } ORDER BY ?s LIMIT 999";var results=await sparql(document.endpoint,q);if(__in__("error",results))shmarql_element.innerHTML=results["error"];
else if(__in__("results",results)&&__in__("bindings",results["results"]))show_single(results["results"]["bindings"])};export var results_clicker=async function(event){event.preventDefault();var wanted=find_attr_parents(event.target,"wanted");var uri=find_attr_parents(event.target,"uri");if(uri)if(wanted=="_")window.open(uri,"_target");else navigate(uri,"?p","?o")};export var init=async function(){if(document.shmarql_prefix)for(var [pfx,replacement]of dict(document.shmarql_prefix).py_items())PREFIX[pfx]=
replacement;document.endpoint=shmarql_element.getAttribute("data-endpoint")||"/sparql";var start_s=shmarql_element.getAttribute("data-s")||"?s";var start_p=shmarql_element.getAttribute("data-p")||"?p";var start_o=shmarql_element.getAttribute("data-o")||"?o";shmarql_element.addEventListener("click",results_clicker);var params=(new URL(document.location)).searchParams;for(var e of params.getAll("endpoint"))document.endpoint=e;var found_param=false;for(var s_param of params.getAll("s")){var start_s=
s_param;var found_param=true}for(var p_param of params.getAll("p")){var start_p=p_param;var found_param=true}for(var o_param of params.getAll("o")){var start_o=o_param;var found_param=true}if(document.endpoint&&found_param)navigate(start_s,start_p,start_o);else{var results=await sparql(document.endpoint,shmarql_element.innerText.strip());if(__in__("results",results)&&__in__("bindings",results["results"]))show_list(results)}};window.addEventListener("load",init);

//# sourceMappingURL=shmarql.map